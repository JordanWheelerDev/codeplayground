<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Code Playground</title>
    <!-- Monaco Editor Styles -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.39.0/min/vs/editor/editor.main.css"
    />
    <link rel="stylesheet" href="css/style.css" />
    <!-- JSZip -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  </head>
  <body>
    <!-- Navigation Bar -->
    <div class="navbar">
      <div class="title">Code Playground</div>
      <div class="toolbar">
        <button onclick="runCode()">Run</button>
        <button onclick="resetCode()">Reset</button>
        <button onclick="downloadCode()">Download</button>
      </div>
    </div>

    <!-- Editor and Output Preview -->
    <div class="editor-container">
      <div class="top-editor-container">
        <div class="editor-box">
          <div class="editor-title">HTML</div>
          <div id="html-editor" class="editor-content"></div>
        </div>
        <div class="editor-box">
          <div class="editor-title">CSS</div>
          <div id="css-editor" class="editor-content"></div>
        </div>
        <div class="editor-box">
          <div class="editor-title">JavaScript</div>
          <div id="js-editor" class="editor-content"></div>
        </div>
      </div>
      <iframe id="output-preview"></iframe>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.39.0/min/vs/loader.js"></script>
    <script>
      require.config({
        paths: {
          vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.39.0/min/vs",
        },
      });

      require(["vs/editor/editor.main"], function () {
        const defaultHtml = `
      <!DOCTYPE html>
      <html>
        <head>
          <link rel="stylesheet" href="style.css">
        </head>
        <body>
          <h1>Hello, World!</h1>
          <button onclick="alert('Welcome!')">Click Me</button>
        </body>
      </html>
              `.trim();

        const defaultCss = `
      body {
        font-family: Arial, sans-serif;
        color: #ffffff;
        background-color: #333;
      }
      h1 {
        color: #ff6347;
      }
              `.trim();

        const defaultJs = `
      console.log("Hello from JavaScript!");
              `.trim();

        const htmlEditor = monaco.editor.create(
          document.getElementById("html-editor"),
          {
            value: defaultHtml,
            language: "html",
            theme: "vs-dark",
            automaticLayout: true,
          }
        );

        const cssEditor = monaco.editor.create(
          document.getElementById("css-editor"),
          {
            value: defaultCss,
            language: "css",
            theme: "vs-dark",
            automaticLayout: true,
          }
        );

        const jsEditor = monaco.editor.create(
          document.getElementById("js-editor"),
          {
            value: defaultJs,
            language: "javascript",
            theme: "vs-dark",
            automaticLayout: true,
          }
        );

        function runCode() {
          const html = htmlEditor.getValue();
          const css = cssEditor.getValue();
          const js = jsEditor.getValue();

          const iframe = document.getElementById("output-preview");
          const doc = iframe.contentDocument || iframe.contentWindow.document;

          doc.open();
          doc.write(html);
          doc.write(`<style>${css}</style>`);
          doc.close();

          iframe.contentWindow.eval(js);
        }

        function resetCode() {
          htmlEditor.setValue(defaultHtml);
          cssEditor.setValue(defaultCss);
          jsEditor.setValue(defaultJs);
          runCode();
        }

        function downloadCode() {
          let html = htmlEditor.getValue();
          const css = cssEditor.getValue();
          const js = jsEditor.getValue();

          html = html.replace(
            "</body>",
            '<script src="script.js"></' + "script></body>"
          );

          const zip = new JSZip();
          zip.file("index.html", html);
          zip.file("style.css", css);
          zip.file("script.js", js);

          zip.generateAsync({ type: "blob" }).then(function (content) {
            const link = document.createElement("a");
            link.href = URL.createObjectURL(content);
            link.download = "code-playground.zip";
            link.click();
          });
        }

        window.runCode = runCode;
        window.resetCode = resetCode;
        window.downloadCode = downloadCode;

        runCode();
      });
    </script>
  </body>
</html>
